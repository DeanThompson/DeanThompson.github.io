<!DOCTYPE HTML>

<html lang="zh-CN">

<head>
	<meta charset="utf-8">
	<title>Golang 排序 - 李林克斯</title>
	<meta name="author" content="map[name:Yangliang Li email:yanglianglee@gmail.com]">

	
	
	<meta name="description" content="">
	

	
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    
	<link href='/index.xml' rel="alternate" title="李林克斯" type="application/atom+xml">
	
	<link rel="canonical" href="http://deanthompson.github.io/posts/2014/06/sort-in-golang">
	<link href="http://deanthompson.github.io/favicon.jpeg" rel="shortcut icon">
	<link href="http://deanthompson.github.io/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="http://deanthompson.github.io/css/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
    <link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
<script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-45384257-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<img src='http://www.gravatar.com/avatar/fe812f189c0479f8cc24d7bd3b76e46d?s=160' alt="Profile Picture" style="width: 160px;" />
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/post/">Archives</a></li>
</ul>


<section class="aboutme">
  <p>
    
  </p>
</section>
</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href='mailto:yanglianglee@gmail.com' title="Email">Email</a>
		
		
		
		
		
			<a class="github" href='https://github.com/DeanThompson' title="GitHub">GitHub</a>
		
		
		
		  <a class="stackoverflow" href='http://stackoverflow.com/users/1461780/leon-young' title="StackOverflow"></a>
		
		
		
		
		
		
			<a class="douban" href='https://www.douban.com/people/Touchthesky' title="Douban">Douban</a>
		
		
		
    	
    	
			<a class="rss" href='/index.xml' title="RSS">RSS</a>
		
	</div>
</nav>
</header>
			</div>
		</div>
		<div class="mid-col">
			
			<div class="mid-col-container">
				<div id="content" class="inner">
					<div itemscope itemtype="http://schema.org/Blog">
					<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <h1 class="title" itemprop="name">Golang 排序</h1>
	<div class="entry-content" itemprop="articleBody">

<h2 id="interface-接口:a0aceb8e02a4cd06e9365f18ce315aea">Interface 接口</h2>

<p>Go 语言标准库提供了排序的package sort，也实现了对 <code>int</code>， <code>float64</code> 和 <code>string</code> 三种基础类型的排序接口。所有排序调用 <code>sort.Sort</code>，内部根据排序数据个数自动切换排序算法（堆排、快排、插排）。下面这段代码出自 Go 标准库 sort/sort.go：</p>

<pre><code class="language-go">func quickSort(data Interface, a, b, maxDepth int) {
    for b-a &gt; 7 {
        if maxDepth == 0 {
            heapSort(data, a, b)
            return
        }
        maxDepth--
        mlo, mhi := doPivot(data, a, b)
        // Avoiding recursion on the larger subproblem guarantees
        // a stack depth of at most lg(b-a).
        if mlo-a &lt; b-mhi {
            quickSort(data, a, mlo, maxDepth)
            a = mhi // i.e., quickSort(data, mhi, b)
        } else {
            quickSort(data, mhi, b, maxDepth)
            b = mlo // i.e., quickSort(data, a, mlo)
        }
    }
    if b-a &gt; 1 {
        insertionSort(data, a, b)
    }
}

// Sort sorts data.
// It makes one call to data.Len to determine n, and O(n*log(n)) calls to
// data.Less and data.Swap. The sort is not guaranteed to be stable.
func Sort(data Interface) {
    // Switch to heapsort if depth of 2*ceil(lg(n+1)) is reached.
    n := data.Len()
    maxDepth := 0
    for i := n; i &gt; 0; i &gt;&gt;= 1 {
        maxDepth++
    }
    maxDepth *= 2
    quickSort(data, 0, n, maxDepth)
}
</code></pre>

<p>这里不详细探讨排序算法的实现和性能细节，主要写一下如何使用标准库对基础数据进行排序，以及如何实现对自定义类型的数据进行排序。</p>

<p>标准库提供一个通用接口，只要实现了这个接口，就可以通过调用 <code>sort.Sort</code> 来排序。</p>

<pre><code class="language-go">type Interface interface {
    // Len is the number of elements in the collection.
    Len() int
    // Less returns whether the element with index i should sort
    // before the element with index j.
    Less(i, j int) bool
    // Swap swaps the elements with indexes i and j.
    Swap(i, j int)
}
</code></pre>

<h2 id="基本数据类型的排序:a0aceb8e02a4cd06e9365f18ce315aea">基本数据类型的排序</h2>

<p><code>Interface</code> 接口的三个函数分别用于获取长度（<code>Len</code>）、大小比较（<code>Less</code>）和交换（<code>Swap</code>）。对 <code>int</code>、<code>float64</code> 和 <code>string</code> 的排序，标准库已经做好了封装，直接调用即可。以 <code>int</code> 为例简单说明：</p>

<pre><code class="language-go">package main                                                                                                                                                                                                 

import (
    &quot;fmt&quot;
    &quot;sort&quot;
)

func main() {
    a := []int{100, 5, 29, 3, 76} 
    fmt.Println(a)     // [100 5 29 3 76]
    sort.Ints(a)       // sort.Sort(IntSlice(a)) 的封装
    fmt.Println(a)     // [3 5 29 76 100]，默认的 Less() 实现的是升序

    a = []int{100, 5, 29, 3, 76} 
    fmt.Println(a)     // [100 5 29 3 76]
    sort.Sort(sort.Reverse(sort.IntSlice(a)))
    fmt.Println(a)     // [100 76 29 5 3]
}
</code></pre>

<p>对 <code>float64</code> 和 <code>string</code> 的排序，和上面类似。需要注意的是，默认的 <code>sort.Less</code> 实现的是升序排列，如果想要让结果降序，可以先用 <code>sort.Reverse</code> 包装一次。这个调用会得到一个 <code>reverse</code> 的类型，包含一个 <code>Interface</code> 的匿名字段，其 <code>Less</code> 函数与 <code>Interface</code> 里的相反，从而实现逆序。</p>

<h2 id="自定义数据类型的排序:a0aceb8e02a4cd06e9365f18ce315aea">自定义数据类型的排序</h2>

<p>如果要对自定义的数据类型进行排序，需要实现 <code>sort.Interface</code> 接口，也就是实现 <code>Len</code>、<code>Less</code> 和 <code>Swap</code> 三个函数。很多场景下 <code>Len</code> 和 <code>Swap</code> 基本上和数据类型无关，所以实际上只有 <code>Less</code> 会有差别。</p>

<p>例如有个游戏下载排行榜，知道游戏ID和对应的下载量，需要把数据根据下载量进行排序。</p>

<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;math/rand&quot;
    &quot;sort&quot;
)

type GameDownloadItem struct {
    GameID        int // 游戏ID
    DownloadTimes int // 下载次数
}

func (self GameDownloadItem) String() string {
    return fmt.Sprintf(&quot;&lt;Item(%d, %d)&gt;&quot;, self.GameID, self.DownloadTimes)
}

type GameDownloadSlice []*GameDownloadItem

func (p GameDownloadSlice) Len() int {
    return len(p)
}

func (p GameDownloadSlice) Swap(i int, j int) {
    p[i], p[j] = p[j], p[i]
}

// 根据游戏下载量 降序 排列
func (p GameDownloadSlice) Less(i int, j int) bool {
    return p[i].DownloadTimes &gt; p[j].DownloadTimes
}

func main() {
    a := make(GameDownloadSlice, 7)
    for i := 0; i &lt; len(a); i++ {
        a[i] = &amp;GameDownloadItem{i + 1, rand.Intn(1000)}
    }

    fmt.Println(a)
    sort.Sort(a)
    fmt.Println(a)
}
</code></pre>

<p>第一次输出结果是随机（每次运行结果都一样）生成的未排序的数据：</p>

<pre><code class="language-text">[&lt;Item(1, 81)&gt; &lt;Item(2, 887)&gt; &lt;Item(3, 847)&gt; &lt;Item(4, 59)&gt; &lt;Item(5, 81)&gt; &lt;Item(6, 318)&gt; &lt;Item(7, 425)&gt;]
</code></pre>

<p>排序后：</p>

<pre><code class="language-text">[&lt;Item(2, 887)&gt; &lt;Item(3, 847)&gt; &lt;Item(7, 425)&gt; &lt;Item(6, 318)&gt; &lt;Item(1, 81)&gt; &lt;Item(5, 81)&gt; &lt;Item(4, 59)&gt;]
</code></pre>

<h2 id="vs-python:a0aceb8e02a4cd06e9365f18ce315aea">Vs. Python</h2>

<p>相比之下，Python 里的排序就非常简单便捷了，直接调用 <code>list</code> 的 <code>sort</code> 方法（in-place）即可，还可以用 built-in 函数 <code>sorted</code> （返回新列表）。对于自定义类型指定属性，或 tuple 指定列的排序也很简单，只需要重新定义一下 <code>sort</code> 方法的 <code>key</code> 参数。对于上面游戏下载量排序的例子，下面是 python 实现版本：</p>

<pre><code class="language-python">#!/usr/bin/env python                                                                                                                                                                                        
# -*- coding: utf-8 -*-

import random

class GameDownloadItem(object):

    def __init__(self, game_id, download_times):
        self.game_id = game_id
        self.download_times = download_times

    def __str__(self):
        return '&lt;Item(%d, %d)&gt;' % (self.game_id, self.download_times)

def display(items):
    for item in items:
        print item,
    print '\n'


if __name__ == &quot;__main__&quot;:
    items = [GameDownloadItem(i+1, random.randrange(1000)) for i in range(7)]
    display(items)

    items.sort(key=lambda item: item.download_times, reverse=True)
    display(items)
</code></pre>

<p>某一次的执行结果：</p>

<pre><code class="language-text">&lt;Item(1, 819)&gt; &lt;Item(2, 959)&gt; &lt;Item(3, 812)&gt; &lt;Item(4, 193)&gt; &lt;Item(5, 408)&gt; &lt;Item(6, 884)&gt; &lt;Item(7, 849)&gt; 

&lt;Item(2, 959)&gt; &lt;Item(6, 884)&gt; &lt;Item(7, 849)&gt; &lt;Item(1, 819)&gt; &lt;Item(3, 812)&gt; &lt;Item(5, 408)&gt; &lt;Item(4, 193)&gt; 
</code></pre>
</div></article>
					
					<section id="comment">
					    <h1 class="title">Comments</h1>
					    <div id="disqus_thread" aria-live="polite"><script type="text/javascript">
var disqus_shortname = "liyangliang";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

<script type="text/javascript">
    var disqus_shortname = "liyangliang";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
					</section>
					
				    </div>
				</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    Yangliang Li

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
<script src="http://deanthompson.github.io/js/slash.js"></script>
<script src="http://deanthompson.github.io/js/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script></footer>
		</div>
	</div>
	
</body>
</html>
